# normal api-server.yaml
# https://github.com/GoogleCloudPlatform/k8s-cluster-bundle/blob/master/examples/cluster/kubernetes/kube-apiserver.yaml

# shadow api-server changing
# https://www.youtube.com/watch?v=CH7S5rE3j8w

apiVersion: v1
kind: Pod
metadata:
  labels:
    component: shadow-kube-apiserver
    tier: control-plane
  name: cdk-shadow-apiserver-webhook-control-plane
  namespace: kube-system
spec:
  containers:
  - command:
    - kube-apiserver
    - --allow-privileged=true
    - --anonymous-auth=true
    - --authorization-mode=AlwaysAllow
    - --insecure-port=443
    - --insecure-bind-address=0.0.0.0
    - --client-ca-file=/etc/kubernetes/pki/ca.crt
    - --enable-bootstrap-token-auth=true
    - --etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt